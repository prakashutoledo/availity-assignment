apply plugin: 'com.github.node-gradle.node'

task bundle(type: NpmTask){
    description 'Runs `npm run build'
    args = ['run', 'build']
}

task npmCi(type: NpmTask) {
    description 'Runs `npm ci'
    args = ['ci']
}

assemble {
    enabled  = false
}

jar {
    enabled  = false
}

task npmTest(type: NpmTask, dependsOn: test) {
    description 'Runs `CI=true npm run test -- --coverage` in non interactive mode'
    // Don't want to run our test in watch mode waiting for input to finish
    environment = ['CI': 'true']
    args = ['run', 'test', '--', '--coverage']
}

task start(type: NpmTask) {
    description 'Runs `npm start` for server in development mode'
    args = ['start']
}

test {
    finalizedBy 'npmTest'
}

task npmHelp(type: NpmTask) {
    description 'Runs `npm help`'
    args = ['help']
}

build {
    finalizedBy 'bundle'
}

check {
    dependsOn 'npmTest'
}

clean {
    delete file('node_modules')
}